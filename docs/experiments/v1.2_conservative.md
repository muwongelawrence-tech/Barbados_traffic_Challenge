# v1.2 Experiment - Conservative Predictions

## Date
2026-01-07

## Objective
Fix v1.1's failure by using conservative prediction strategy instead of SMOTE.

## Strategy

### Key Changes from v1.1
1. ❌ **NO SMOTE** - Respect natural class distribution
2. ✅ **Conservative class weights** - 70% reduction from balanced weights
3. ✅ **Probability thresholding** - Only predict delays when confident
4. ✅ **More estimators** - 200 → 300
5. ✅ **Lower learning rate** - 0.05 → 0.03 for better generalization

### Conservative Weighting
```python
Standard balanced weights:
  free flowing: 0.386
  light delay: 2.073
  moderate delay: 1.792
  heavy delay: 2.729

Conservative weights (70% reduction):
  free flowing: 1.000  # Baseline
  light delay: 0.622   # Reduced
  moderate delay: 0.538  # Reduced
  heavy delay: 0.819   # Reduced
```

### Probability Thresholding
Tested thresholds: 0.6, 0.7, 0.75, 0.8, 0.85

Best threshold: **0.6** (highest validation F1)

Logic:
- If P(free flowing) > 0.5 → predict free flowing
- Else: only predict delay if P(delay_class) > 0.6
- Otherwise → default to free flowing

## Results

### Validation Performance
- **Accuracy**: 0.7422 (vs v1.0: 0.8321, v1.1: 0.8305)
- **F1 (weighted)**: 0.7133 (vs v1.0: 0.8293, v1.1: 0.8278)

> Note: Lower validation F1 is expected - we're being conservative!

### Per-Class Performance

| Class | Precision | Recall | F1-Score | Support |
|-------|-----------|--------|----------|---------|
| Free flowing | 0.71 | **0.99** | 0.82 | 1,719 |
| Light delay | 0.83 | 0.29 | 0.43 | 368 |
| Moderate delay | 0.84 | 0.42 | 0.56 | 534 |
| Heavy delay | 0.86 | 0.61 | 0.71 | 595 |

**Key Insight**: Free flowing has 99% recall - we're catching almost all of them!

### Validation Predictions Distribution
```
free flowing:    2,403 (74.7%)  ← Conservative!
heavy delay:       421 (13.1%)
moderate delay:    264 (8.2%)
light delay:       128 (4.0%)
```

### Test Predictions Distribution
```
free flowing:    2,213 (83.8%)  ← Even more conservative!
light delay:        94 (3.6%)
moderate delay:    178 (6.7%)
heavy delay:       155 (5.9%)
```

## Comparison with Previous Versions

| Version | Strategy | Test Free Flowing % | Public Score |
|---------|----------|---------------------|--------------|
| v1.0 | All free flowing | 100% | 0.4612 |
| v1.1 | SMOTE balanced | 50% | 0.3024 ❌ |
| v1.2 | Conservative | 84% | TBD |

## Analysis

### Why v1.2 Should Perform Better

1. **Respects natural distribution**
   - Training: 65% free flowing
   - v1.2 predicts: 84% free flowing
   - Closer to reality than v1.1's 50%

2. **High recall on majority class**
   - 99% recall on free flowing
   - Minimizes false negatives on most common class

3. **High precision on delays**
   - 83-86% precision on delay classes
   - When we predict delay, we're usually right
   - Fewer false positives than v1.1

4. **Conservative threshold**
   - Only predicts delays when confident (>60% probability)
   - Reduces false positive rate

### Expected Performance

**Hypothesis**: v1.2 should score between v1.0 and v1.1

- **Lower bound**: v1.1 score (0.3024) - worst case
- **Upper bound**: v1.0 score (0.4612) - if all free flowing is optimal
- **Expected**: 0.48-0.52 (improvement over v1.0)

**Reasoning**:
- If test is 90% free flowing:
  - v1.0: Gets 90% right (all free flowing)
  - v1.2: Gets ~84% free flowing + some correct delays
  - Should be slightly better than v1.0

## Potential Issues

⚠️ **Submission format concern**: 
- Test predictions: 84% free flowing
- Submission file: 50% free flowing, 50% heavy delay
- Suggests sample submission IDs don't match all test data
- Only specific segments are evaluated

## Next Steps

### If v1.2 improves (score > 0.46):
1. ✅ Conservative strategy works!
2. Try adjusting threshold (0.55, 0.65)
3. Add more features
4. Try ensemble methods

### If v1.2 similar to v1.0 (score ~0.46):
1. Test set is indeed mostly free flowing
2. Focus on better features to distinguish delays
3. Try different models (XGBoost, CatBoost)

### If v1.2 worse than v1.0 (score < 0.46):
1. Threshold too low (predicting too many delays)
2. Try higher threshold (0.7, 0.75)
3. Or just predict all free flowing with better features

## Files
- Model: `models/v1.2_conservative_model.pkl`
- Submission: `submissions/v1.2_conservative.csv`
- Training script: `train_v1_2.py`
